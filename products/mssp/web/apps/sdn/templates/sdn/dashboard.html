{% extends 'sdn/base.html' %}

{% block sdn_title %}SDN Dashboard{% endblock %}
{% block sdn_breadcrumb %}
<li class="breadcrumb-item active">Dashboard</li>
{% endblock %}

{% block sdn_content %}
<!-- Stats Cards -->
<div class="row">
    <div class="col-lg-4 col-6">
        <div class="small-box bg-info metric-card">
            <div class="inner">
                <h3>{{ vlans.count }}</h3>
                <p>Active VLANs</p>
            </div>
            <div class="icon">
                <i class="fas fa-layer-group"></i>
            </div>
            <a href="{% url 'sdn:vlan_list' %}" class="small-box-footer">
                Manage VLANs <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <div class="col-lg-4 col-6">
        <div class="small-box bg-success metric-card">
            <div class="inner">
                <h3>{{ devices.count }}</h3>
                <p>Registered Devices</p>
            </div>
            <div class="icon">
                <i class="fas fa-microchip"></i>
            </div>
            <a href="{% url 'sdn:device_list' %}" class="small-box-footer">
                Manage Devices <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <div class="col-lg-4 col-6">
        <div class="small-box bg-warning metric-card">
            <div class="inner">
                <h3>{{ categories.count }}</h3>
                <p>Device Categories</p>
            </div>
            <div class="icon">
                <i class="fas fa-tags"></i>
            </div>
            <a href="{% url 'sdn:category_list' %}" class="small-box-footer">
                Manage Categories <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
</div>

<!-- Recent Devices -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-clock mr-2"></i>
                    Recently Active Devices
                </h3>
            </div>
            <div class="card-body p-0">
                {% if devices %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Device</th>
                                <th>MAC Address</th>
                                <th>Category</th>
                                <th>VLAN</th>
                                <th>Last Seen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for device in devices %}
                            <tr>
                                <td>
                                    <strong>{{ device.friendly_name }}</strong>
                                    {% if device.hostname %}
                                    <br><small class="text-muted">{{ device.hostname }}</small>
                                    {% endif %}
                                </td>
                                <td><code class="mac-address-display">{{ device.mac_address }}</code></td>
                                <td>
                                    {% if device.category %}
                                    <span class="badge" style="background: {{ device.category.color }}30; color: {{ device.category.color }}; border: 1px solid {{ device.category.color }};">
                                        {{ device.category.name }}
                                    </span>
                                    {% else %}
                                    <span class="badge badge-secondary">Uncategorized</span>
                                    {% endif %}
                                </td>
                                <td><span class="badge badge-info">{{ device.get_vlan_id }}</span></td>
                                <td>{{ device.last_seen|default:"Never" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-microchip fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No devices registered yet.</p>
                    <a href="{% url 'sdn:device_list' %}" class="btn btn-primary">
                        <i class="fas fa-plus mr-1"></i> Add Device
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Guardian Access Points -->
{% if guardians %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-wifi mr-2"></i>
                    Guardian Access Points
                </h3>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Guardian</th>
                                <th>Hotspot SSID</th>
                                <th>Upstream</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for config in guardians %}
                            <tr>
                                <td><strong>{{ config.guardian }}</strong></td>
                                <td><code>{{ config.hotspot_ssid }}</code></td>
                                <td>
                                    {% if config.upstream_connected %}
                                    <span class="badge badge-success">{{ config.upstream_ssid }}</span>
                                    {% else %}
                                    <span class="badge badge-warning">Not Connected</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if config.is_active %}
                                    <span class="badge status-online">Active</span>
                                    {% else %}
                                    <span class="badge status-offline">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'sdn:guardian_setup' config.guardian.id %}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-cog mr-1"></i> Configure
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
