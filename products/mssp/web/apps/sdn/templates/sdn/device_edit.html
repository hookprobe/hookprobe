{% extends 'sdn/base.html' %}

{% block sdn_title %}Edit Device{% endblock %}
{% block sdn_breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'sdn:device_list' %}">Devices</a></li>
<li class="breadcrumb-item active">{{ device.friendly_name }}</li>
{% endblock %}

{% block sdn_content %}
<!-- Edit Device Form -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-edit mr-2"></i>
            Edit Device: {{ device.friendly_name }}
        </h3>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="mac_address">MAC Address</label>
                        <input type="text" class="form-control" id="mac_address" value="{{ device.mac_address }}" disabled>
                        <small class="form-text text-muted">MAC address cannot be changed</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="friendly_name">Friendly Name</label>
                        <input type="text" class="form-control" id="friendly_name" name="friendly_name" value="{{ device.friendly_name }}" required>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="hostname">Hostname</label>
                        <input type="text" class="form-control" id="hostname" name="hostname" value="{{ device.hostname }}" placeholder="device-hostname">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="category">Category</label>
                        <select class="form-control" id="category" name="category">
                            <option value="">-- No Category --</option>
                            {% for cat in categories %}
                            <option value="{{ cat.id }}" {% if device.category_id == cat.id %}selected{% endif %}>
                                {{ cat.name }} (VLAN {{ cat.default_vlan }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="form-group">
                        <label for="vlan">Override VLAN (optional)</label>
                        <select class="form-control" id="vlan" name="vlan">
                            <option value="">-- Use Category Default --</option>
                            {% for vlan in vlans %}
                            <option value="{{ vlan.id }}" {% if device.vlan_id == vlan.id %}selected{% endif %}>
                                VLAN {{ vlan.vlan_id }}: {{ vlan.name }}
                            </option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted">Override the category's default VLAN for this specific device</small>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="manufacturer">Manufacturer</label>
                        <input type="text" class="form-control" id="manufacturer" name="manufacturer" value="{{ device.manufacturer }}" placeholder="Samsung, Philips, etc.">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="model">Model</label>
                        <input type="text" class="form-control" id="model" name="model" value="{{ device.model }}" placeholder="Model name/number">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Additional notes about this device">{{ device.notes }}</textarea>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="is_active" name="is_active" {% if device.is_active %}checked{% endif %}>
                        <label class="custom-control-label" for="is_active">Device Active</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="is_blocked" name="is_blocked" {% if device.is_blocked %}checked{% endif %}>
                        <label class="custom-control-label" for="is_blocked">Block Device (deny network access)</label>
                    </div>
                </div>
            </div>

            <div class="btn-group">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save mr-1"></i> Save Changes
                </button>
                <a href="{% url 'sdn:device_list' %}" class="btn btn-secondary">
                    <i class="fas fa-times mr-1"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Device Information -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-info-circle mr-2"></i>
            Device Information
        </h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4 text-center">
                <div class="info-box bg-info">
                    <span class="info-box-icon"><i class="fas fa-network-wired"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Current VLAN</span>
                        <span class="info-box-number">{{ device.get_vlan_id }}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="info-box bg-success">
                    <span class="info-box-icon"><i class="fas fa-clock"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Last Seen</span>
                        <span class="info-box-number" style="font-size: 0.9rem;">
                            {% if device.last_seen %}{{ device.last_seen|timesince }} ago{% else %}Never{% endif %}
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="info-box bg-warning">
                    <span class="info-box-icon"><i class="fas fa-map-marker-alt"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Last IP</span>
                        <span class="info-box-number">{% if device.last_ip %}{{ device.last_ip }}{% else %}Unknown{% endif %}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
