# HookProbe Guardian - NetworkManager Configuration
# Version: 5.1.0
#
# This configuration prevents NetworkManager from interfering with
# interfaces managed by Open vSwitch and hostapd.
#
# Managed by NetworkManager:
#   - wlan0 (WAN interface for upstream WiFi connection)
#   - eth0 (Ethernet WAN - if not used by OVS)
#
# Unmanaged (controlled by OVS/hostapd):
#   - wlan1 (AP interface, managed by hostapd)
#   - br0 (OVS bridge)
#   - ovs-* (OVS internal ports)
#   - vlan* (VLAN interfaces)
#
# Install location: /etc/NetworkManager/conf.d/guardian-unmanaged.conf
#
# NOTE: This is a TEMPLATE. Run guardian-nm-setup.sh to generate
# the actual config with your device's MAC addresses.

[keyfile]
# Interfaces that NetworkManager should NOT manage
# Uses glob patterns for matching
unmanaged-devices=interface-name:wlan1;interface-name:br*;interface-name:ovs-*;interface-name:vlan*;interface-name:guardian;driver:openvswitch

[device]
# ============================================================
# MAC ADDRESS RANDOMIZATION - DISABLED
# ============================================================
# Disable all MAC randomization to ensure stable connections
# and prevent interference with network policies

# Disable MAC randomization during WiFi scanning
wifi.scan-rand-mac-address=no

# Disable MAC cloning/spoofing
wifi.cloned-mac-address=preserve
ethernet.cloned-mac-address=preserve

[device-wlan0]
# Specific settings for wlan0 (WAN WiFi interface)
match-device=interface-name:wlan0
wifi.scan-rand-mac-address=no
wifi.cloned-mac-address=preserve

[device-eth0]
# Specific settings for eth0 (Ethernet interface)
match-device=interface-name:eth0
ethernet.cloned-mac-address=preserve

[connection]
# ============================================================
# CONNECTION DEFAULTS
# ============================================================
# Disable MAC randomization for all connections
wifi.cloned-mac-address=preserve
ethernet.cloned-mac-address=preserve

# Don't auto-connect to random networks
wifi.wake-on-wlan=ignore

# Connection stability settings
connection.auth-retries=3

[connection-wifi-wlan0]
# WiFi connections on wlan0 should preserve MAC
match-device=interface-name:wlan0
wifi.cloned-mac-address=preserve

[main]
# Use internal DHCP client (more reliable than dhclient)
dhcp=internal

# Don't modify resolv.conf - dnsmasq handles DNS
dns=none
