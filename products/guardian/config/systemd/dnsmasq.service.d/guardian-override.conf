# Guardian Override for dnsmasq.service
# Removes dependency on network-online.target to allow DHCP startup without WAN
# This enables Guardian clients to get IP addresses even when disconnected from internet
#
# Version: 5.1.0

[Unit]
# Clear the default After= and Wants= that may include network-online.target
After=
Wants=

# Our dependencies - start after hostapd, not after WAN
After=guardian-wlan.service hostapd.service network.target
Wants=hostapd.service

# Don't block on network-online - DHCP must work offline
# This is critical for clients to connect to Guardian in offline mode

[Service]
# Restart automatically if dnsmasq crashes
Restart=on-failure
RestartSec=5

# Give the service time to start
TimeoutStartSec=30

# Ensure dnsmasq binds to br0 even if it's not fully ready
ExecStartPre=/bin/sleep 2
