# Guardian Override for hostapd.service
# Removes dependency on network-online.target to allow AP startup without WAN
# This enables Guardian to work in offline/disconnected mode
#
# Version: 5.1.1

[Unit]
# Clear the systemd ConditionFileNotEmpty check to prevent race conditions
# during fresh install (config file is created during setup)
ConditionFileNotEmpty=

# Clear the default After= and Wants= that include network-online.target
After=
Wants=

# Our dependencies - start after wlan interface is ready, not after WAN
After=guardian-wlan.service guardian-offline.service local-fs.target
Wants=guardian-wlan.service
Requires=guardian-wlan.service

# Don't block on network-online - we ARE the network for clients
# This is critical for offline-first operation

[Service]
# Restart automatically if hostapd crashes
Restart=on-failure
RestartSec=5

# Give the service time to start
TimeoutStartSec=30

# Environment for hostapd
Environment="DAEMON_CONF=/etc/hostapd/hostapd.conf"

# Verify config exists before starting (replaces ConditionFileNotEmpty)
ExecStartPre=/bin/test -s /etc/hostapd/hostapd.conf
