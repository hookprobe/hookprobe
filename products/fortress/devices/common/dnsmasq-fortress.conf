# dnsmasq configuration for Fortress OVS VLAN network
# Provides DHCP and DNS services for all VLANs
#
# Install: cp dnsmasq-fortress.conf /etc/dnsmasq.d/fortress.conf
# Restart: systemctl restart dnsmasq
#

# General settings
domain-needed
bogus-priv
no-resolv
no-poll

# Upstream DNS servers
server=1.1.1.1
server=8.8.8.8

# Local domain
local=/fortress.local/
domain=fortress.local

# Don't read /etc/hosts
no-hosts

# DHCP authoritative mode
dhcp-authoritative

# Rapid commit for faster DHCP (RFC 4039)
dhcp-rapid-commit

# ============================================
# Interface bindings
# ============================================

# Listen on OVS VLAN interfaces (NOT the main bridge)
interface=vlan10
interface=vlan20
interface=vlan30
interface=vlan40
interface=vlan99

# Also listen on WiFi interfaces if not bridged
# interface=wlan0
# interface=wlp6s0

# Bind only to specified interfaces
bind-interfaces

# ============================================
# VLAN 10 - Management (10.250.10.0/24)
# ============================================
dhcp-range=vlan10,10.250.10.100,10.250.10.199,255.255.255.0,12h
dhcp-option=vlan10,3,10.250.10.1    # Gateway
dhcp-option=vlan10,6,10.250.10.1    # DNS

# ============================================
# VLAN 20 - POS/Payment (10.250.20.0/24)
# ============================================
dhcp-range=vlan20,10.250.20.100,10.250.20.199,255.255.255.0,12h
dhcp-option=vlan20,3,10.250.20.1    # Gateway
dhcp-option=vlan20,6,10.250.20.1    # DNS

# ============================================
# VLAN 30 - Staff (10.250.30.0/24)
# ============================================
dhcp-range=vlan30,10.250.30.100,10.250.30.199,255.255.255.0,12h
dhcp-option=vlan30,3,10.250.30.1    # Gateway
dhcp-option=vlan30,6,10.250.30.1    # DNS

# ============================================
# VLAN 40 - Guest WiFi (10.250.40.0/24)
# ============================================
dhcp-range=vlan40,10.250.40.100,10.250.40.199,255.255.255.0,2h
dhcp-option=vlan40,3,10.250.40.1    # Gateway
dhcp-option=vlan40,6,10.250.40.1    # DNS
# Shorter lease for guests

# ============================================
# VLAN 99 - IoT Devices (10.250.99.0/24)
# ============================================
dhcp-range=vlan99,10.250.99.100,10.250.99.199,255.255.255.0,24h
dhcp-option=vlan99,3,10.250.99.1    # Gateway
dhcp-option=vlan99,6,10.250.99.1    # DNS

# ============================================
# Main Bridge (10.250.0.0/16) - fallback
# ============================================
# Only if clients connect directly to fortress bridge
interface=fortress
dhcp-range=fortress,10.250.1.100,10.250.1.199,255.255.0.0,12h
dhcp-option=fortress,3,10.250.0.1   # Gateway
dhcp-option=fortress,6,10.250.0.1   # DNS

# ============================================
# Static leases (examples)
# ============================================
# dhcp-host=AA:BB:CC:DD:EE:FF,10.250.10.10,admin-laptop
# dhcp-host=11:22:33:44:55:66,10.250.20.10,pos-terminal-1

# ============================================
# Logging
# ============================================
log-facility=/var/log/dnsmasq.log
log-dhcp

# ============================================
# DNS caching
# ============================================
cache-size=1000
