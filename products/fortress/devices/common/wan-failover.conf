# HookProbe Fortress - WAN Failover Configuration (PBR)
# /etc/hookprobe/wan-failover.conf
#
# This file configures Policy-Based Routing (PBR) for dual-WAN failover.
# The monitor checks WAN connectivity and seamlessly switches traffic
# when the primary becomes unreachable (even if link is still up).
#
# Architecture:
#   - Table 100 (wan_primary): Routes via primary WAN
#   - Table 200 (wan_backup):  Routes via backup WAN
#   - nftables marks packets based on active WAN
#   - Conntrack preserves marks for sticky sessions
#
# This ensures existing connections survive failover events.

# ============================================================
# INTERFACES (leave empty for auto-detection)
# ============================================================

# Primary WAN interface (auto-detected from default route if empty)
# Examples: eth0, enp1s0, eno1
PRIMARY_IFACE=""

# Backup WAN interface (auto-detected from WWAN/second ethernet if empty)
# Examples: wwan0, wwp0s20f0u4, eth1
BACKUP_IFACE=""

# ============================================================
# GATEWAYS (leave empty for auto-discovery)
# ============================================================

# Gateway addresses (auto-discovered via nmcli/DHCP if empty)
# Set manually only if auto-discovery fails
PRIMARY_GATEWAY=""
BACKUP_GATEWAY=""

# ============================================================
# HEALTH CHECK TARGETS
# ============================================================

# Space-separated list of IPs to ping for health checks
# Using multiple targets increases reliability
# The check passes if ANY target responds
PING_TARGETS="1.1.1.1 8.8.8.8 9.9.9.9"

# Ping timeout in seconds
PING_TIMEOUT=3

# Number of pings per target
PING_COUNT=2

# ============================================================
# TIMING
# ============================================================

# Interval between health checks (seconds)
# Lower = faster failover but more traffic/CPU
# Recommended: 5 for fast failover, 10-15 for LTE data saving
CHECK_INTERVAL=5

# ============================================================
# FAILOVER THRESHOLDS (Hysteresis)
# ============================================================

# Number of consecutive successes to mark WAN as UP
# Higher = more stable but slower to recover
UP_THRESHOLD=3

# Number of consecutive failures to mark WAN as DOWN
# Higher = more tolerant of transient issues
DOWN_THRESHOLD=3

# Legacy variable names (for backward compatibility)
# FAIL_THRESHOLD and RECOVER_THRESHOLD are also accepted
# FAIL_THRESHOLD=3      # Maps to DOWN_THRESHOLD
# RECOVER_THRESHOLD=5   # Maps to UP_THRESHOLD

# ============================================================
# DNS FAILOVER
# ============================================================

# Enable automatic DNS server switching on failover
# When enabled, updates dnsmasq/resolv.conf to use active WAN's DNS
DNS_FAILOVER_ENABLED=true

# Override DNS servers (leave empty for auto-discovery from interface)
# PRIMARY_DNS=""
# BACKUP_DNS=""

# ============================================================
# ADVANCED
# ============================================================

# Enable debug logging (1 = enabled, 0 = disabled)
DEBUG=0

# State file for persistence across restarts
# STATE_FILE="/run/fortress/wan-failover.state"

# ============================================================
# NETWORK RANGES (for PBR packet marking)
# ============================================================

# LAN network range (clients that should use PBR)
# LAN_NETWORK="10.200.0.0/23"

# Container networks (services tier gets internet access)
# CONTAINER_SERVICES="172.20.201.0/24"
