# HookProbe Fortress - dnsXai Log Rotation
# Installed to: /etc/logrotate.d/hookprobe-dnsxai
#
# Rotates dnsXai DNS query and blocked domain logs
# Keeps 30 days of history for security auditing and ML training

/var/log/hookprobe/dnsxai-queries.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    # Use copytruncate instead of rename+signal
    # This truncates the file in place, so processes keep writing to the same fd
    # No need to signal dnsXai to reopen log files
    copytruncate
    dateext
    dateformat -%Y%m%d
    # NOTE: Removed postrotate SIGHUP - copytruncate handles rotation safely
    # The engine has SIGHUP handler as fallback but it's not needed with copytruncate
}

/var/log/hookprobe/dnsxai-blocked.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    # Use copytruncate - safer than signaling container processes
    copytruncate
    dateext
    dateformat -%Y%m%d
    # NOTE: Removed postrotate SIGHUP - copytruncate handles rotation safely
}

/var/log/hookprobe/dnsxai-training.log {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
    dateext
    dateformat -%Y%m%d
}
