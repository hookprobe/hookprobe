{% extends "base.html" %}

{% block title %}SLA AI - Business Continuity{% endblock %}

{% block extra_css %}
<style>
/* SLA AI Dashboard Styles */
.slaai-container {
    padding: 0;
}

/* Header Status Bar */
.slaai-status-bar {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid rgba(255,255,255,0.1);
}

.slaai-status-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
}

/* RTO/RPO Gauges */
.gauge-card {
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    padding: 1.25rem;
    text-align: center;
}

.gauge-card .gauge-title {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #888;
    margin-bottom: 0.75rem;
}

.gauge-ring {
    width: 100px;
    height: 100px;
    margin: 0 auto 0.75rem;
    position: relative;
}

.gauge-ring svg {
    transform: rotate(-90deg);
    width: 100%;
    height: 100%;
}

.gauge-ring .gauge-bg {
    fill: none;
    stroke: rgba(255,255,255,0.1);
    stroke-width: 8;
}

.gauge-ring .gauge-fill {
    fill: none;
    stroke-width: 8;
    stroke-linecap: round;
    transition: stroke-dashoffset 0.5s ease;
}

.gauge-ring .gauge-value {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.gauge-ring .gauge-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: #fff;
    display: block;
}

.gauge-ring .gauge-unit {
    font-size: 0.7rem;
    color: #888;
}

.gauge-card .gauge-status {
    font-size: 0.75rem;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    display: inline-block;
}

.gauge-status.ok { background: rgba(76, 175, 80, 0.2); color: #81c784; }
.gauge-status.warning { background: rgba(255, 152, 0, 0.2); color: #ffb74d; }
.gauge-status.critical { background: rgba(244, 67, 54, 0.2); color: #e57373; }

/* WAN Interface Cards */
.wan-cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.wan-card {
    background: #1a1a2e;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(255,255,255,0.1);
}

.wan-card.active {
    border-color: rgba(76, 175, 80, 0.5);
    box-shadow: 0 0 20px rgba(76, 175, 80, 0.1);
}

.wan-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.wan-card-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.wan-card-title .icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.wan-card-title .icon.primary { background: rgba(79, 195, 247, 0.2); color: #4fc3f7; }
.wan-card-title .icon.backup { background: rgba(255, 152, 0, 0.2); color: #ffb74d; }

.wan-card-title h4 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
}

.wan-card-title .interface {
    font-size: 0.75rem;
    color: #888;
}

.wan-status-badge {
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
}

.wan-status-badge.active { background: rgba(76, 175, 80, 0.2); color: #81c784; }
.wan-status-badge.standby { background: rgba(255, 255, 255, 0.1); color: #888; }
.wan-status-badge.failed { background: rgba(244, 67, 54, 0.2); color: #e57373; }

/* Health Bar */
.health-bar-container {
    margin-bottom: 1rem;
}

.health-bar-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    margin-bottom: 0.35rem;
}

.health-bar-label span:first-child { color: #888; }
.health-bar-label span:last-child { color: #fff; font-weight: 600; }

.health-bar {
    height: 8px;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
    overflow: hidden;
}

.health-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease, background 0.3s ease;
}

/* Metrics Grid */
.wan-metrics {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
}

.wan-metric {
    text-align: center;
    padding: 0.5rem;
    background: rgba(255,255,255,0.03);
    border-radius: 6px;
}

.wan-metric-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: #fff;
}

.wan-metric-label {
    font-size: 0.65rem;
    color: #666;
    text-transform: uppercase;
}

/* Traffic Pips */
.traffic-pips-container {
    background: #1a1a2e;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.traffic-pips-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.traffic-pips-header h4 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
}

.traffic-pips-legend {
    display: flex;
    gap: 1rem;
    font-size: 0.75rem;
    color: #888;
}

.traffic-pips-legend .pip-sample {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
}

.traffic-pips-legend .pip {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.traffic-pips-legend .pip.active { background: #4fc3f7; box-shadow: 0 0 6px rgba(79, 195, 247, 0.5); }
.traffic-pips-legend .pip.inactive { background: rgba(255,255,255,0.2); }

.vlan-traffic-row {
    display: flex;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.vlan-traffic-row:last-child { border-bottom: none; }

.vlan-name {
    width: 120px;
    font-size: 0.85rem;
    font-weight: 500;
}

.vlan-pips {
    flex: 1;
    display: flex;
    gap: 3px;
}

.vlan-pips .pip {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    transition: all 0.3s ease;
}

.vlan-pips .pip.active {
    background: var(--pip-color, #4fc3f7);
    box-shadow: 0 0 6px var(--pip-color, rgba(79, 195, 247, 0.5));
    animation: pip-pulse 1s ease-in-out infinite;
}

@keyframes pip-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.vlan-traffic-value {
    width: 100px;
    text-align: right;
    font-size: 0.85rem;
    font-weight: 600;
}

.vlan-traffic-direction {
    width: 40px;
    text-align: center;
    font-size: 0.8rem;
    color: #888;
}

/* Section Headers */
.traffic-section-header {
    display: flex;
    align-items: center;
    padding: 0.75rem 0;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    font-weight: 600;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-top: 1px solid rgba(255,255,255,0.1);
}

.traffic-section-header:first-of-type {
    border-top: none;
    margin-top: 0;
}

/* Filter Bar */
.traffic-filter-bar {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    border: 1px solid rgba(255,255,255,0.2);
    background: transparent;
    color: #888;
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-btn:hover {
    border-color: rgba(255,255,255,0.4);
    color: #fff;
}

.filter-btn.active {
    background: rgba(79, 195, 247, 0.2);
    border-color: #4fc3f7;
    color: #4fc3f7;
}

.filter-btn i {
    margin-right: 0.35rem;
}

/* Cost Tracking */
.cost-panel {
    background: #1a1a2e;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.cost-panel h4 {
    margin: 0 0 1rem;
    font-size: 1rem;
    font-weight: 600;
}

.cost-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.cost-item {
    background: rgba(255,255,255,0.03);
    border-radius: 8px;
    padding: 1rem;
}

.cost-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.cost-item-label {
    font-size: 0.75rem;
    color: #888;
    text-transform: uppercase;
}

.cost-item-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: #fff;
}

.cost-bar {
    height: 6px;
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.cost-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s ease;
}

/* Failover Timeline */
.failover-timeline {
    background: #1a1a2e;
    border-radius: 12px;
    padding: 1.5rem;
}

.failover-timeline h4 {
    margin: 0 0 1rem;
    font-size: 1rem;
    font-weight: 600;
}

.timeline-track {
    position: relative;
    height: 60px;
    background: rgba(255,255,255,0.03);
    border-radius: 8px;
    margin-bottom: 1rem;
    overflow: hidden;
}

.timeline-line {
    position: absolute;
    top: 50%;
    left: 20px;
    right: 20px;
    height: 2px;
    background: rgba(255,255,255,0.2);
    transform: translateY(-50%);
}

.timeline-event {
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 16px;
    height: 16px;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.2s;
}

.timeline-event:hover {
    transform: translate(-50%, -50%) scale(1.3);
}

.timeline-event.failover { background: #e57373; box-shadow: 0 0 10px rgba(229, 115, 115, 0.5); }
.timeline-event.failback { background: #81c784; box-shadow: 0 0 10px rgba(129, 199, 132, 0.5); }
.timeline-event.now { background: #4fc3f7; box-shadow: 0 0 10px rgba(79, 195, 247, 0.5); }

.timeline-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: #666;
}

.timeline-events-list {
    max-height: 150px;
    overflow-y: auto;
}

.timeline-event-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    background: rgba(255,255,255,0.03);
}

.timeline-event-item .event-icon {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
}

.timeline-event-item .event-icon.failover { background: rgba(244, 67, 54, 0.2); color: #e57373; }
.timeline-event-item .event-icon.failback { background: rgba(76, 175, 80, 0.2); color: #81c784; }

.timeline-event-item .event-details {
    flex: 1;
}

.timeline-event-item .event-type {
    font-size: 0.85rem;
    font-weight: 500;
}

.timeline-event-item .event-reason {
    font-size: 0.75rem;
    color: #888;
}

.timeline-event-item .event-time {
    font-size: 0.75rem;
    color: #666;
    text-align: right;
}

.timeline-event-item .event-duration {
    font-size: 0.7rem;
    color: #4fc3f7;
}

/* Responsive */
@media (max-width: 1200px) {
    .slaai-status-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .slaai-status-grid {
        grid-template-columns: 1fr;
    }

    .wan-cards {
        grid-template-columns: 1fr;
    }

    .wan-metrics {
        grid-template-columns: repeat(2, 1fr);
    }

    .cost-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0"><i class="fas fa-heartbeat mr-2"></i>SLA AI - Business Continuity</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('sdn.index') }}">SDN</a></li>
                    <li class="breadcrumb-item active">SLA AI</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid slaai-container">

        {% if not slaai_available %}
        <div class="alert alert-warning alert-dismissible">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <i class="fas fa-info-circle mr-2"></i>
            <strong>Demo Mode:</strong> SLA AI engine not connected. Showing sample data.
        </div>
        {% endif %}

        <!-- RTO/RPO Status Bar -->
        <div class="slaai-status-bar">
            <div class="slaai-status-grid">
                <!-- RTO Gauge -->
                <div class="gauge-card">
                    <div class="gauge-title">Recovery Time Objective</div>
                    <div class="gauge-ring">
                        <svg viewBox="0 0 100 100">
                            <circle class="gauge-bg" cx="50" cy="50" r="40"/>
                            <circle class="gauge-fill" cx="50" cy="50" r="40"
                                    stroke-dasharray="251.2"
                                    stroke-dashoffset="25.12"
                                    id="rto-gauge"
                                    style="stroke: #81c784;"/>
                        </svg>
                        <div class="gauge-value">
                            <span class="gauge-number" id="rto-value">2.3</span>
                            <span class="gauge-unit">seconds</span>
                        </div>
                    </div>
                    <div class="gauge-status ok" id="rto-status">
                        <i class="fas fa-check mr-1"></i>Target: 5s
                    </div>
                </div>

                <!-- RPO Gauge -->
                <div class="gauge-card">
                    <div class="gauge-title">Recovery Point Objective</div>
                    <div class="gauge-ring">
                        <svg viewBox="0 0 100 100">
                            <circle class="gauge-bg" cx="50" cy="50" r="40"/>
                            <circle class="gauge-fill" cx="50" cy="50" r="40"
                                    stroke-dasharray="251.2"
                                    stroke-dashoffset="0"
                                    id="rpo-gauge"
                                    style="stroke: #81c784;"/>
                        </svg>
                        <div class="gauge-value">
                            <span class="gauge-number" id="rpo-value">0</span>
                            <span class="gauge-unit">bytes lost</span>
                        </div>
                    </div>
                    <div class="gauge-status ok" id="rpo-status">
                        <i class="fas fa-check mr-1"></i>Zero Data Loss
                    </div>
                </div>

                <!-- Uptime Gauge -->
                <div class="gauge-card">
                    <div class="gauge-title">24h Uptime</div>
                    <div class="gauge-ring">
                        <svg viewBox="0 0 100 100">
                            <circle class="gauge-bg" cx="50" cy="50" r="40"/>
                            <circle class="gauge-fill" cx="50" cy="50" r="40"
                                    stroke-dasharray="251.2"
                                    stroke-dashoffset="0.31"
                                    id="uptime-gauge"
                                    style="stroke: #81c784;"/>
                        </svg>
                        <div class="gauge-value">
                            <span class="gauge-number" id="uptime-value">99.87</span>
                            <span class="gauge-unit">%</span>
                        </div>
                    </div>
                    <div class="gauge-status ok" id="uptime-status">
                        <i class="fas fa-check mr-1"></i>Target: 99.9%
                    </div>
                </div>

                <!-- Failovers Gauge -->
                <div class="gauge-card">
                    <div class="gauge-title">Failovers (24h)</div>
                    <div class="gauge-ring">
                        <svg viewBox="0 0 100 100">
                            <circle class="gauge-bg" cx="50" cy="50" r="40"/>
                            <circle class="gauge-fill" cx="50" cy="50" r="40"
                                    stroke-dasharray="251.2"
                                    stroke-dashoffset="188.4"
                                    id="failover-gauge"
                                    style="stroke: #ffb74d;"/>
                        </svg>
                        <div class="gauge-value">
                            <span class="gauge-number" id="failover-count">1</span>
                            <span class="gauge-unit">switches</span>
                        </div>
                    </div>
                    <div class="gauge-status warning" id="failover-status">
                        <i class="fas fa-exchange-alt mr-1"></i>Max: 4/day
                    </div>
                </div>
            </div>
        </div>

        <!-- WAN Interface Cards -->
        <div class="wan-cards">
            <!-- Primary WAN -->
            <div class="wan-card active" id="primary-wan-card">
                <div class="wan-card-header">
                    <div class="wan-card-title">
                        <div class="icon primary"><i class="fas fa-ethernet"></i></div>
                        <div>
                            <h4>Primary WAN</h4>
                            <span class="interface" id="primary-interface">eth0</span>
                        </div>
                    </div>
                    <span class="wan-status-badge active" id="primary-status">● ACTIVE</span>
                </div>

                <div class="health-bar-container">
                    <div class="health-bar-label">
                        <span>Health Score</span>
                        <span id="primary-health-value">92%</span>
                    </div>
                    <div class="health-bar">
                        <div class="health-bar-fill" id="primary-health-bar" style="width: 92%; background: linear-gradient(90deg, #4caf50, #81c784);"></div>
                    </div>
                </div>

                <div class="wan-metrics">
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="primary-rtt">12ms</div>
                        <div class="wan-metric-label">RTT</div>
                    </div>
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="primary-jitter">1.2ms</div>
                        <div class="wan-metric-label">Jitter</div>
                    </div>
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="primary-loss">0%</div>
                        <div class="wan-metric-label">Loss</div>
                    </div>
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="primary-speed">1Gbps</div>
                        <div class="wan-metric-label">Speed</div>
                    </div>
                </div>
            </div>

            <!-- Backup WAN -->
            <div class="wan-card" id="backup-wan-card">
                <div class="wan-card-header">
                    <div class="wan-card-title">
                        <div class="icon backup"><i class="fas fa-signal"></i></div>
                        <div>
                            <h4>Backup WAN (LTE)</h4>
                            <span class="interface" id="backup-interface">wwan0</span>
                        </div>
                    </div>
                    <span class="wan-status-badge standby" id="backup-status">○ STANDBY</span>
                </div>

                <div class="health-bar-container">
                    <div class="health-bar-label">
                        <span>Health Score</span>
                        <span id="backup-health-value">65%</span>
                    </div>
                    <div class="health-bar">
                        <div class="health-bar-fill" id="backup-health-bar" style="width: 65%; background: linear-gradient(90deg, #ff9800, #ffb74d);"></div>
                    </div>
                </div>

                <div class="wan-metrics">
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="backup-rtt">45ms</div>
                        <div class="wan-metric-label">RTT</div>
                    </div>
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="backup-signal">-75dBm</div>
                        <div class="wan-metric-label">Signal</div>
                    </div>
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="backup-loss">0.1%</div>
                        <div class="wan-metric-label">Loss</div>
                    </div>
                    <div class="wan-metric">
                        <div class="wan-metric-value" id="backup-speed">50Mbps</div>
                        <div class="wan-metric-label">Speed</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interface Traffic Pips -->
        <div class="traffic-pips-container">
            <div class="traffic-pips-header">
                <h4><i class="fas fa-chart-bar mr-2"></i>Interface Traffic (Real-time)</h4>
                <div class="traffic-pips-legend">
                    <span class="pip-sample"><span class="pip active"></span> Active (5 Mbps/pip)</span>
                    <span class="pip-sample"><span class="pip inactive"></span> Inactive</span>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="traffic-filter-bar">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-th"></i>All
                </button>
                <button class="filter-btn" data-filter="wan">
                    <i class="fas fa-globe"></i>WAN
                </button>
                <button class="filter-btn" data-filter="bridge">
                    <i class="fas fa-project-diagram"></i>Bridge/WiFi
                </button>
                <button class="filter-btn" data-filter="vlan">
                    <i class="fas fa-layer-group"></i>VLANs
                </button>
                <button class="filter-btn" data-filter="container">
                    <i class="fas fa-cube"></i>Containers
                </button>
            </div>

            <!-- WAN Interfaces Section -->
            <div class="traffic-section-header">
                <i class="fas fa-globe mr-2"></i>WAN Interfaces
            </div>
            <div id="wan-traffic-pips">
                <div class="vlan-traffic-row" data-iface="eth0" style="--pip-color: #4fc3f7;">
                    <span class="vlan-name"><i class="fas fa-ethernet mr-1"></i>eth0 (WAN)</span>
                    <div class="vlan-pips" id="pips-wan"></div>
                    <span class="vlan-traffic-value" id="traffic-wan">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-iface="wwan0" style="--pip-color: #ffb74d;">
                    <span class="vlan-name"><i class="fas fa-signal mr-1"></i>wwan0 (LTE)</span>
                    <div class="vlan-pips" id="pips-lte"></div>
                    <span class="vlan-traffic-value" id="traffic-lte">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
            </div>

            <!-- Bridge & WiFi Section -->
            <div class="traffic-section-header">
                <i class="fas fa-project-diagram mr-2"></i>Bridge & WiFi
            </div>
            <div id="bridge-traffic-pips">
                <div class="vlan-traffic-row" data-iface="FTS" style="--pip-color: #ce93d8;">
                    <span class="vlan-name"><i class="fas fa-network-wired mr-1"></i>FTS (Bridge)</span>
                    <div class="vlan-pips" id="pips-fts"></div>
                    <span class="vlan-traffic-value" id="traffic-fts">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-iface="wlan0" style="--pip-color: #81c784;">
                    <span class="vlan-name"><i class="fas fa-wifi mr-1"></i>wlan0 (2.4GHz)</span>
                    <div class="vlan-pips" id="pips-wifi24"></div>
                    <span class="vlan-traffic-value" id="traffic-wifi24">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-iface="wlan1" style="--pip-color: #00d9ff;">
                    <span class="vlan-name"><i class="fas fa-wifi mr-1"></i>wlan1 (5GHz)</span>
                    <div class="vlan-pips" id="pips-wifi5"></div>
                    <span class="vlan-traffic-value" id="traffic-wifi5">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
            </div>

            <!-- VLAN Traffic Section -->
            <div class="traffic-section-header">
                <i class="fas fa-layer-group mr-2"></i>VLAN Traffic
            </div>
            <div id="vlan-traffic-pips">
                <div class="vlan-traffic-row" data-vlan="100" style="--pip-color: #4fc3f7;">
                    <span class="vlan-name">vlan100 (LAN)</span>
                    <div class="vlan-pips" id="pips-100"></div>
                    <span class="vlan-traffic-value" id="traffic-100">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-vlan="200" style="--pip-color: #ce93d8;">
                    <span class="vlan-name">vlan200 (MGMT)</span>
                    <div class="vlan-pips" id="pips-200"></div>
                    <span class="vlan-traffic-value" id="traffic-200">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-vlan="30" style="--pip-color: #81c784;">
                    <span class="vlan-name">vlan30 (STAFF)</span>
                    <div class="vlan-pips" id="pips-30"></div>
                    <span class="vlan-traffic-value" id="traffic-30">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-vlan="40" style="--pip-color: #ffb74d;">
                    <span class="vlan-name">vlan40 (GUEST)</span>
                    <div class="vlan-pips" id="pips-40"></div>
                    <span class="vlan-traffic-value" id="traffic-40">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-vlan="20" style="--pip-color: #64b5f6;">
                    <span class="vlan-name">vlan20 (POS)</span>
                    <div class="vlan-pips" id="pips-20"></div>
                    <span class="vlan-traffic-value" id="traffic-20">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-vlan="50" style="--pip-color: #4dd0e1;">
                    <span class="vlan-name">vlan50 (CAMERAS)</span>
                    <div class="vlan-pips" id="pips-50"></div>
                    <span class="vlan-traffic-value" id="traffic-50">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-vlan="99" style="--pip-color: #e57373;">
                    <span class="vlan-name">vlan99 (QUARANTINE)</span>
                    <div class="vlan-pips" id="pips-99"></div>
                    <span class="vlan-traffic-value" id="traffic-99">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
            </div>

            <!-- Container Network Section -->
            <div class="traffic-section-header">
                <i class="fas fa-docker mr-2"></i>Container Network (172.20.200.0/24)
            </div>
            <div id="container-traffic-pips">
                <div class="vlan-traffic-row" data-container="web" style="--pip-color: #64b5f6;">
                    <span class="vlan-name"><i class="fas fa-globe mr-1"></i>fortress-web</span>
                    <div class="vlan-pips" id="pips-web"></div>
                    <span class="vlan-traffic-value" id="traffic-web">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-container="postgres" style="--pip-color: #336791;">
                    <span class="vlan-name"><i class="fas fa-database mr-1"></i>fortress-postgres</span>
                    <div class="vlan-pips" id="pips-postgres"></div>
                    <span class="vlan-traffic-value" id="traffic-postgres">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-container="redis" style="--pip-color: #d82c20;">
                    <span class="vlan-name"><i class="fas fa-memory mr-1"></i>fortress-redis</span>
                    <div class="vlan-pips" id="pips-redis"></div>
                    <span class="vlan-traffic-value" id="traffic-redis">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-container="qsecbit" style="--pip-color: #81c784;">
                    <span class="vlan-name"><i class="fas fa-shield-alt mr-1"></i>fortress-qsecbit</span>
                    <div class="vlan-pips" id="pips-qsecbit"></div>
                    <span class="vlan-traffic-value" id="traffic-qsecbit">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-container="dnsxai" style="--pip-color: #ff9800;">
                    <span class="vlan-name"><i class="fas fa-brain mr-1"></i>fortress-dnsxai</span>
                    <div class="vlan-pips" id="pips-dnsxai"></div>
                    <span class="vlan-traffic-value" id="traffic-dnsxai">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
                <div class="vlan-traffic-row" data-container="dfs" style="--pip-color: #9c27b0;">
                    <span class="vlan-name"><i class="fas fa-broadcast-tower mr-1"></i>fortress-dfs</span>
                    <div class="vlan-pips" id="pips-dfs"></div>
                    <span class="vlan-traffic-value" id="traffic-dfs">-- Mbps</span>
                    <span class="vlan-traffic-direction">↑↓</span>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Cost Tracking -->
            <div class="col-md-6">
                <div class="cost-panel">
                    <h4><i class="fas fa-dollar-sign mr-2"></i>LTE Data Budget (wwan0)</h4>
                    <div class="cost-grid">
                        <div class="cost-item">
                            <div class="cost-item-header">
                                <span class="cost-item-label">Daily Usage</span>
                                <span class="cost-item-value" id="daily-usage">145 MB</span>
                            </div>
                            <div class="cost-bar">
                                <div class="cost-bar-fill" id="daily-bar" style="width: 29%; background: linear-gradient(90deg, #4caf50, #81c784);"></div>
                            </div>
                            <div style="font-size: 0.7rem; color: #888; margin-top: 0.25rem;">
                                <span id="daily-budget">500 MB budget</span> · <span id="daily-pct">29%</span>
                            </div>
                        </div>
                        <div class="cost-item">
                            <div class="cost-item-header">
                                <span class="cost-item-label">Monthly Usage</span>
                                <span class="cost-item-value" id="monthly-usage">2.1 GB</span>
                            </div>
                            <div class="cost-bar">
                                <div class="cost-bar-fill" id="monthly-bar" style="width: 21%; background: linear-gradient(90deg, #4caf50, #81c784);"></div>
                            </div>
                            <div style="font-size: 0.7rem; color: #888; margin-top: 0.25rem;">
                                <span id="monthly-budget">10 GB budget</span> · <span id="monthly-pct">21%</span>
                            </div>
                        </div>
                        <div class="cost-item">
                            <div class="cost-item-header">
                                <span class="cost-item-label">Current Cost</span>
                                <span class="cost-item-value" id="current-cost">$4.30</span>
                            </div>
                            <div style="font-size: 0.75rem; color: #81c784; margin-top: 0.5rem;">
                                <i class="fas fa-check-circle mr-1"></i>Under budget
                            </div>
                        </div>
                        <div class="cost-item">
                            <div class="cost-item-header">
                                <span class="cost-item-label">Budget Remaining</span>
                                <span class="cost-item-value" id="budget-remaining">$15.70</span>
                            </div>
                            <div style="font-size: 0.75rem; color: #888; margin-top: 0.5rem;">
                                <i class="fas fa-info-circle mr-1"></i>$20/month total
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Failover Timeline -->
            <div class="col-md-6">
                <div class="failover-timeline">
                    <h4><i class="fas fa-history mr-2"></i>Failover Timeline (24h)</h4>
                    <div class="timeline-track">
                        <div class="timeline-line"></div>
                        <div class="timeline-event failover" id="event-1" style="left: 15%;" title="02:15 - Failover"></div>
                        <div class="timeline-event failback" id="event-2" style="left: 35%;" title="06:42 - Failback"></div>
                        <div class="timeline-event now" style="left: 95%;" title="Now"></div>
                    </div>
                    <div class="timeline-labels">
                        <span>24h ago</span>
                        <span>12h ago</span>
                        <span>Now</span>
                    </div>

                    <div class="timeline-events-list" id="timeline-events">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
const PIPS_PER_ROW = 20;
const MBPS_PER_PIP = 5;

// Initialize traffic pips
function initPips() {
    document.querySelectorAll('.vlan-pips').forEach(container => {
        let pipsHtml = '';
        for (let i = 0; i < PIPS_PER_ROW; i++) {
            pipsHtml += '<span class="pip"></span>';
        }
        container.innerHTML = pipsHtml;
    });
}

// Update traffic pips for a VLAN
function updateTrafficPips(vlanId, mbps) {
    const container = document.getElementById(`pips-${vlanId}`);
    const valueEl = document.getElementById(`traffic-${vlanId}`);

    if (!container) return;

    const activePips = Math.min(PIPS_PER_ROW, Math.ceil(mbps / MBPS_PER_PIP));
    const pips = container.querySelectorAll('.pip');

    pips.forEach((pip, i) => {
        if (i < activePips) {
            pip.classList.add('active');
        } else {
            pip.classList.remove('active');
        }
    });

    if (valueEl) {
        valueEl.textContent = `${mbps} Mbps`;
    }
}

// Load SLA status
async function loadSLAStatus() {
    try {
        const res = await fetch('/slaai/api/status');
        const data = await res.json();

        if (data.success) {
            updateDashboard(data.status);
        }
    } catch (error) {
        console.error('Error loading SLA status:', error);
    }
}

function updateDashboard(status) {
    // RTO
    if (status.rto_actual_s !== undefined) {
        document.getElementById('rto-value').textContent = status.rto_actual_s.toFixed(1);
        const rtoPercent = Math.min(100, (status.rto_actual_s / status.rto_target_s) * 100);
        updateGauge('rto-gauge', 100 - rtoPercent, rtoPercent <= 80 ? '#81c784' : '#ffb74d');
    }

    // RPO
    if (status.rpo_actual_bytes !== undefined) {
        document.getElementById('rpo-value').textContent = status.rpo_actual_bytes;
    }

    // Uptime
    if (status.uptime_pct !== undefined) {
        document.getElementById('uptime-value').textContent = status.uptime_pct.toFixed(2);
        updateGauge('uptime-gauge', status.uptime_pct, status.uptime_pct >= 99.9 ? '#81c784' : '#ffb74d');
    }

    // Failover count
    if (status.failover_count_24h !== undefined) {
        document.getElementById('failover-count').textContent = status.failover_count_24h;
    }

    // WAN health
    if (status.primary_health !== undefined) {
        const primaryPct = Math.round(status.primary_health * 100);
        document.getElementById('primary-health-value').textContent = `${primaryPct}%`;
        document.getElementById('primary-health-bar').style.width = `${primaryPct}%`;
    }

    if (status.backup_health !== undefined) {
        const backupPct = Math.round(status.backup_health * 100);
        document.getElementById('backup-health-value').textContent = `${backupPct}%`;
        document.getElementById('backup-health-bar').style.width = `${backupPct}%`;
    }

    // Cost tracking
    if (status.cost_status) {
        const cost = status.cost_status;
        document.getElementById('daily-usage').textContent = `${cost.daily_usage_mb} MB`;
        document.getElementById('monthly-usage').textContent = `${(cost.monthly_usage_mb / 1024).toFixed(1)} GB`;
        document.getElementById('current-cost').textContent = `$${cost.current_cost.toFixed(2)}`;
        document.getElementById('budget-remaining').textContent = `$${cost.budget_remaining.toFixed(2)}`;

        const dailyPct = (cost.daily_usage_mb / cost.daily_budget_mb) * 100;
        const monthlyPct = (cost.monthly_usage_mb / cost.monthly_budget_mb) * 100;
        document.getElementById('daily-bar').style.width = `${dailyPct}%`;
        document.getElementById('monthly-bar').style.width = `${monthlyPct}%`;
        document.getElementById('daily-pct').textContent = `${Math.round(dailyPct)}%`;
        document.getElementById('monthly-pct').textContent = `${Math.round(monthlyPct)}%`;
    }

    // Timeline events
    if (status.failover_history) {
        updateTimeline(status.failover_history);
    }
}

function updateGauge(id, percent, color) {
    const gauge = document.getElementById(id);
    if (gauge) {
        const circumference = 2 * Math.PI * 40;
        const offset = circumference * (1 - percent / 100);
        gauge.style.strokeDashoffset = offset;
        gauge.style.stroke = color;
    }
}

function updateTimeline(events) {
    const container = document.getElementById('timeline-events');
    if (!container || !events.length) return;

    container.innerHTML = events.map(event => {
        const time = new Date(event.timestamp);
        const timeStr = time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        const typeClass = event.type === 'failover' ? 'failover' : 'failback';
        const icon = event.type === 'failover' ? 'fa-arrow-right' : 'fa-arrow-left';

        return `
            <div class="timeline-event-item">
                <div class="event-icon ${typeClass}">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="event-details">
                    <div class="event-type">${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</div>
                    <div class="event-reason">${event.reason}</div>
                </div>
                <div class="event-time">
                    ${timeStr}
                    <div class="event-duration">${event.duration_s}s</div>
                </div>
            </div>
        `;
    }).join('');
}

// Simulate traffic for demo - all interfaces
function simulateTraffic() {
    // WAN interfaces
    const wanInterfaces = {
        'wan': { min: 150, max: 250 },
        'lte': { min: 5, max: 25 }
    };

    // Bridge/WiFi interfaces
    const bridgeInterfaces = {
        'fts': { min: 180, max: 300 },
        'wifi24': { min: 30, max: 50 },
        'wifi5': { min: 70, max: 120 }
    };

    // VLAN interfaces
    const vlans = {
        100: { min: 40, max: 60 },
        200: { min: 2, max: 8 },
        30: { min: 20, max: 35 },
        40: { min: 30, max: 55 },
        20: { min: 5, max: 15 },
        50: { min: 50, max: 70 },
        99: { min: 0, max: 2 }
    };

    // Container interfaces
    const containers = {
        'web': { min: 5, max: 20 },
        'postgres': { min: 2, max: 10 },
        'redis': { min: 1, max: 5 },
        'qsecbit': { min: 3, max: 12 },
        'dnsxai': { min: 8, max: 25 },
        'dfs': { min: 1, max: 4 }
    };

    // Update all interfaces
    Object.entries(wanInterfaces).forEach(([iface, range]) => {
        const traffic = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
        updateTrafficPipsGeneric(iface, traffic);
    });

    Object.entries(bridgeInterfaces).forEach(([iface, range]) => {
        const traffic = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
        updateTrafficPipsGeneric(iface, traffic);
    });

    Object.entries(vlans).forEach(([vlan, range]) => {
        const traffic = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
        updateTrafficPips(vlan, traffic);
    });

    Object.entries(containers).forEach(([container, range]) => {
        const traffic = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
        updateTrafficPipsGeneric(container, traffic);
    });
}

// Generic traffic pips update
function updateTrafficPipsGeneric(id, mbps) {
    const container = document.getElementById(`pips-${id}`);
    const valueEl = document.getElementById(`traffic-${id}`);

    if (!container) return;

    const activePips = Math.min(PIPS_PER_ROW, Math.ceil(mbps / MBPS_PER_PIP));
    const pips = container.querySelectorAll('.pip');

    pips.forEach((pip, i) => {
        if (i < activePips) {
            pip.classList.add('active');
        } else {
            pip.classList.remove('active');
        }
    });

    if (valueEl) {
        valueEl.textContent = `${mbps} Mbps`;
    }
}

// Filter traffic sections
function filterTrafficSections(filter) {
    const sections = {
        wan: document.getElementById('wan-traffic-pips'),
        bridge: document.getElementById('bridge-traffic-pips'),
        vlan: document.getElementById('vlan-traffic-pips'),
        container: document.getElementById('container-traffic-pips')
    };

    const headers = document.querySelectorAll('.traffic-section-header');

    if (filter === 'all') {
        // Show all
        Object.values(sections).forEach(section => {
            if (section) section.style.display = 'block';
        });
        headers.forEach(h => h.style.display = 'flex');
    } else {
        // Hide all first
        Object.values(sections).forEach(section => {
            if (section) section.style.display = 'none';
        });
        headers.forEach(h => h.style.display = 'none');

        // Show selected
        if (sections[filter]) {
            sections[filter].style.display = 'block';
            // Find and show corresponding header
            const headerIndex = Object.keys(sections).indexOf(filter);
            if (headers[headerIndex]) headers[headerIndex].style.display = 'flex';
        }
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    initPips();
    loadSLAStatus();
    simulateTraffic();

    // Filter button handlers
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Update active state
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            // Apply filter
            const filter = this.getAttribute('data-filter');
            filterTrafficSections(filter);
        });
    });

    // Refresh every 5 seconds
    setInterval(loadSLAStatus, 5000);
    setInterval(simulateTraffic, 3000);
});
</script>
{% endblock %}
