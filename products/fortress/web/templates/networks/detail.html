{% extends "base.html" %}
{% block title %}{{ vlan.name }} - HookProbe Fortress{% endblock %}
{% block page_title %}VLAN {{ vlan.vlan_id }} - {{ vlan.name }}{% endblock %}
{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('networks.index') }}">Networks</a></li>
<li class="breadcrumb-item active">{{ vlan.name }}</li>
{% endblock %}

{% block content %}
<div class="row">
    <!-- VLAN Info Card -->
    <div class="col-md-6">
        <div class="card card-outline card-{% if vlan.vlan_id == 10 %}primary{% elif vlan.vlan_id == 20 %}success{% elif vlan.vlan_id == 30 %}info{% elif vlan.vlan_id == 40 %}secondary{% else %}warning{% endif %}">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-{% if vlan.vlan_id == 10 %}shield-alt{% elif vlan.vlan_id == 20 %}cash-register{% elif vlan.vlan_id == 30 %}users{% elif vlan.vlan_id == 40 %}wifi{% else %}microchip{% endif %} mr-2"></i>
                    VLAN Information
                </h3>
                <div class="card-tools">
                    <span class="badge badge-{% if vlan.interface_up %}success{% else %}danger{% endif %}">
                        {{ 'Interface UP' if vlan.interface_up else 'Interface DOWN' }}
                    </span>
                </div>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <th style="width: 40%">VLAN ID</th>
                        <td><code>{{ vlan.vlan_id }}</code></td>
                    </tr>
                    <tr>
                        <th>Name</th>
                        <td>{{ vlan.name }}</td>
                    </tr>
                    <tr>
                        <th>Subnet</th>
                        <td><code>{{ vlan.subnet }}</code></td>
                    </tr>
                    <tr>
                        <th>Gateway</th>
                        <td><code>{{ vlan.gateway }}</code></td>
                    </tr>
                    <tr>
                        <th>Connected Devices</th>
                        <td><span class="badge badge-info">{{ vlan.device_count }}</span></td>
                    </tr>
                    <tr>
                        <th>DHCP Status</th>
                        <td>
                            {% if vlan.dhcp_enabled %}
                            <span class="badge badge-success"><i class="fas fa-check"></i> Enabled</span>
                            {% if vlan.dhcp_running %}
                            <span class="badge badge-success ml-1"><i class="fas fa-play"></i> Running</span>
                            {% endif %}
                            {% else %}
                            <span class="badge badge-secondary"><i class="fas fa-times"></i> Disabled</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>DNS Policy</th>
                        <td>
                            <span class="badge badge-{% if vlan.dns_policy == 'strict' %}warning{% else %}info{% endif %}">
                                {{ vlan.dns_policy|capitalize }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <th>Isolation</th>
                        <td>
                            {% if vlan.is_isolated %}
                            <span class="badge badge-danger"><i class="fas fa-lock"></i> Isolated</span>
                            <small class="text-muted">- Cannot reach other VLANs</small>
                            {% else %}
                            <span class="badge badge-success"><i class="fas fa-unlock"></i> Open</span>
                            <small class="text-muted">- Can reach other VLANs</small>
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Configuration Card -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-cog mr-2"></i>Configuration</h3>
            </div>
            <div class="card-body">
                <form action="{{ url_for('networks.configure', vlan_id=vlan.vlan_id) }}" method="post">
                    <div class="form-group">
                        <label for="name">VLAN Name</label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ vlan.name }}" {% if not db_available %}disabled{% endif %}>
                    </div>
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="dhcp_enabled" name="dhcp_enabled" {% if vlan.dhcp_enabled %}checked{% endif %} {% if not db_available %}disabled{% endif %}>
                            <label class="custom-control-label" for="dhcp_enabled">DHCP Enabled</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="is_isolated" name="is_isolated" {% if vlan.is_isolated %}checked{% endif %} {% if not db_available %}disabled{% endif %}>
                            <label class="custom-control-label" for="is_isolated">Network Isolation</label>
                            <small class="form-text text-muted">Prevent communication with other VLANs</small>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" {% if not db_available %}disabled{% endif %}>
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                </form>
            </div>
        </div>

        <!-- DNS Policy Card -->
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-dns mr-2"></i>DNS Policy</h3>
            </div>
            <div class="card-body">
                <form action="{{ url_for('networks.set_dns_policy', vlan_id=vlan.vlan_id) }}" method="post">
                    <div class="form-group">
                        <select name="dns_policy" class="form-control" {% if not db_available %}disabled{% endif %}>
                            <option value="standard" {% if vlan.dns_policy == 'standard' %}selected{% endif %}>Standard - Basic filtering</option>
                            <option value="strict" {% if vlan.dns_policy == 'strict' %}selected{% endif %}>Strict - Ads, trackers, malware blocked</option>
                            <option value="kids" {% if vlan.dns_policy == 'kids' %}selected{% endif %}>Kids - Family-safe content only</option>
                            <option value="none" {% if vlan.dns_policy == 'none' %}selected{% endif %}>None - No filtering</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-info" {% if not db_available %}disabled{% endif %}>
                        <i class="fas fa-shield-alt"></i> Apply DNS Policy
                    </button>
                </form>
            </div>
        </div>

        <!-- Bandwidth Limit Card -->
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-tachometer-alt mr-2"></i>Bandwidth Limit</h3>
            </div>
            <div class="card-body">
                <form action="{{ url_for('networks.set_bandwidth', vlan_id=vlan.vlan_id) }}" method="post">
                    <div class="form-group">
                        <label for="bandwidth_limit">Maximum Bandwidth (Mbps)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="bandwidth_limit" name="bandwidth_limit" value="{{ vlan.bandwidth_limit|default(0) }}" min="0" max="1000" {% if not db_available %}disabled{% endif %}>
                            <div class="input-group-append">
                                <span class="input-group-text">Mbps</span>
                            </div>
                        </div>
                        <small class="form-text text-muted">Set to 0 for unlimited bandwidth</small>
                    </div>
                    <button type="submit" class="btn btn-warning" {% if not db_available %}disabled{% endif %}>
                        <i class="fas fa-tachometer-alt"></i> Apply Limit
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Connected Devices -->
{% if devices %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-laptop mr-2"></i>Connected Devices</h3>
            </div>
            <div class="card-body table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Hostname</th>
                            <th>MAC Address</th>
                            <th>IP Address</th>
                            <th>Type</th>
                            <th>Last Seen</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for device in devices %}
                        <tr class="{% if device.is_blocked %}table-danger{% endif %}">
                            <td>
                                <i class="fas fa-{{ 'laptop' if device.device_type == 'laptop' else 'mobile-alt' if device.device_type == 'phone' else 'cash-register' if device.device_type == 'pos' else 'video' if device.device_type == 'camera' else 'microchip' }}"></i>
                                {{ device.hostname or 'Unknown' }}
                            </td>
                            <td><code>{{ device.mac_address }}</code></td>
                            <td>{{ device.ip_address }}</td>
                            <td>{{ device.device_type|capitalize }}</td>
                            <td>{{ device.last_seen }}</td>
                            <td>
                                <a href="{{ url_for('clients.detail', mac_address=device.mac_address) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i> Details
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Back Button -->
<div class="row mt-3">
    <div class="col-12">
        <a href="{{ url_for('networks.index') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Networks
        </a>
    </div>
</div>

{% if not db_available %}
<div class="alert alert-warning mt-3">
    <i class="fas fa-exclamation-triangle"></i>
    <strong>Demo Mode:</strong> Database is not connected. Changes will not be saved.
</div>
{% endif %}
{% endblock %}
